var e=Object.defineProperty,t=Object.assign,s=(t,s,o)=>("symbol"!=typeof s&&(s+=""),s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[s]=o);import{P as o,a as n}from"./vendor.cc851aa9.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(s){const o=new URL(e,location),n=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((s,i)=>{const a=new URL(e,o);if(self[t].moduleMap[a])return s(self[t].moduleMap[a]);const r=new Blob([`import * as m from '${a}';`,`${t}.moduleMap['${a}']=m;`],{type:"text/javascript"}),c=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(r),onerror(){i(new Error(`Failed to import: ${e}`)),n(c)},onload(){s(self[t].moduleMap[a]),n(c)}});document.head.appendChild(c)})),self[t].moduleMap={}}}("/phaser-test/assets/");class i extends o.Scene{constructor(){super("preloader")}preload(){this.load.spritesheet("sokoban","/phaser-test/assets/sokoban_tilesheet.a7f7b83c.png",{frameWidth:64}),this.load.image("character","data:image/png;base64,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"),this.load.image("concrete","/phaser-test/assets/concrete.b037b885.jpg")}create(){this.scene.start("game")}}class a extends o.Scene{constructor(){super("game"),s(this,"cursors"),s(this,"player"),this.player=null,this.playerSprites={}}init(){this.cursors=this.input.keyboard.addKeys({up:o.Input.Keyboard.KeyCodes.UP,down:o.Input.Keyboard.KeyCodes.DOWN,left:o.Input.Keyboard.KeyCodes.LEFT,right:o.Input.Keyboard.KeyCodes.RIGHT,space:o.Input.Keyboard.KeyCodes.SPACE,shift:o.Input.Keyboard.KeyCodes.SHIFT,up_alt:o.Input.Keyboard.KeyCodes.W,down_alt:o.Input.Keyboard.KeyCodes.S,left_alt:o.Input.Keyboard.KeyCodes.A,right_alt:o.Input.Keyboard.KeyCodes.D}),this.connection=this.registry.get("connection"),this.gameState=this.registry.get("gameState")}create(){this.scale;const e=this.connection.hostId;this.peerId=this.connection.peerId,this.add.tileSprite(0,0,1e3,1e3,"concrete"),this.add.text(6,6,"Game join code: "+e,{font:"12px Arial",fill:"#ffffff"}).setScrollFactor(0),this.renderPlayerSprites(),this.input.on("pointermove",(e=>{if(!this.player)return;const t=o.Math.Angle.Between(this.player.x,this.player.y,e.x+this.cameras.main.scrollX,e.y+this.cameras.main.scrollY);this.player.setRotation(t+Math.PI/2)}))}renderPlayerSprites(){const e=this.gameState.getPlayers();for(let t of e)this.playerSprites[t.id]?this.playerSprites[t.id].setX(t.x).setY(t.y).setTexture(t.texture).setRotation(t.rotation):(this.playerSprites[t.id]=this.physics.add.sprite(t.x,t.y,t.texture).setRotation(t.rotation),t.id===this.peerId&&(this.player=this.playerSprites[t.id],this.cameras.main.startFollow(this.player)))}updatePlayer(){let e={id:this.peerId,x:this.player.x,y:this.player.y,texture:this.player.texture.key,rotation:this.player.rotation};this.gameState.updatePlayer(e)}update(){if(!this.player)return;const e=200;this.cursors.left.isDown||this.cursors.left_alt.isDown?this.player.setVelocity(-200,0):this.cursors.right.isDown||this.cursors.right_alt.isDown?this.player.setVelocity(e,0):this.cursors.up.isDown||this.cursors.up_alt.isDown?this.player.setVelocity(0,-200):this.cursors.down.isDown||this.cursors.down_alt.isDown?this.player.setVelocity(0,e):this.player.setVelocity(0,0),this.updatePlayer(),this.renderPlayerSprites()}}const r=new class{constructor(){this.isHosting=null,this.guestConnections={},this.hostConnection=null,this.peerId=function(e=6){let t="";const s="abcdefghijklmnopqrstuvwxyz0123456789";for(let o=0;o<e;o++)t+=s.charAt(Math.floor(Math.random()*s.length));return t}(),this.hostId=null,this.peer=new n(this.peerId,{host:"richard-peerjs-server.herokuapp.com",port:443,path:"/",secure:!0}),this.peer.on("open",(e=>{this.peerId=e,console.log("Connection to server established. ID is: "+e)})),this.peer.on("error",(e=>{console.log("Error1: ",e),console.log("reconnecting"),this.peer.disconnect(),this.peer.reconnect()}))}async beginHosting(){console.error("hosting"),this.isHosting=!0,this.hostId=this.peerId,this.peer.on("connection",(async e=>{this.guestConnections[e.peer]=e,this.hostConnection.send("hello from host"),console.log("Connecting to peer "+e.peer),await this.setupConnectionHandlers(e),this.onGuestConnected&&this.onGuestConnected(e.peer,e.metadata)}))}async connectToHost(e,t){this.isHosting=!1,console.log("connecting to "+e),this.hostConnection=this.peer.connect(e,{metadata:t}),this.hostConnection.send("hello from guest"),this.hostId=this.hostConnection.peer,console.log("waiting for connection..."),await this.setupConnectionHandlers(this.hostConnection),this.onConnectedToHost&&this.onConnectedToHost(this.hostConnection.peer,this.hostConnection.metadata)}sendToHost(e){if(this.isHosting)throw new Error("Cannot send data to host if you are hosting");this.hostConnection.send(e)}sendToGuest(e,t){if(!this.isHosting)throw new Error("Cannot send data to guest if you are not the host");this.guestConnections[e].send(t)}sendToAllGuests(e){if(!this.isHosting)throw new Error("Cannot send data to guest if you are not the host");for(let t of Object.keys(this.guestConnections))this.guestConnections[t].open&&this.guestConnections[t].send(e)}async ensureConnectionOpen(e){return new Promise(((t,s)=>{e.open&&t(),console.log(e),e.on("open",(function(){console.log("Connection open"),t()})),e.on("error",(function(e){console.error("Connection error",e),s()})),this.peer.on("error",(e=>{console.error(e),s()}))}))}async setupConnectionHandlers(e){await this.ensureConnectionOpen(e),e.on("data",(e=>{console.log(e),this.onMessage&&this.onMessage(e)})),e.on("close",(()=>{console.error("Connection closed")}))}},c=new class{constructor(e){this.connection=e,this.setupConnectionHandlers(),this.state={players:{}}}onChange(){this.connection.isHosting?this.connection.sendToAllGuests({type:"game-state",data:this.state}):console.error("cannot sent data to all guests if you are not the host")}sendPlayerStateToHost(e){this.connection.isHosting?console.error("cannot sent player data to host if you are the host"):this.connection.sendToHost({type:"player-state",data:e})}setupConnectionHandlers(){this.connection.onGuestConnected=(e,t)=>{console.log("connected "+e),this.addPlayer(t)},this.connection.onMessage=e=>{switch(e.type){case"game-state":this.state=e.data;break;case"player-state":this.state.players[e.data.id]=e.data}}}addPlayer(e){this.state.players[e.id]=e,this.onChange()}getPlayers(){return Object.values(this.state.players)}updatePlayer(e){this.state.players[e.id]=t(t({},this.state.players[e.id]),e),this.connection.isHosting?this.onChange():this.sendPlayerStateToHost(this.state.players[e.id])}}(r);window.connection=r,window.gameState=c;const h={type:o.AUTO,width:800,height:600,parent:"game-container",physics:{default:"arcade",arcade:{gravity:{y:0}}},scale:{mode:o.Scale.FIT},scene:[i,a]};function l(){document.querySelector("#game-setup").style.display="none";const e=new o.Game(h);e.registry.set("connection",r),e.registry.set("gameState",c)}window.onload=function(){const e=document.querySelector("#username"),t=document.querySelector("#join-game-id"),s=document.querySelector("#join-button");document.querySelector("#host-button").addEventListener("click",(()=>{e.value?function(e){c.addPlayer({id:r.peerId,name:e,x:100,y:100,texture:"character",rotation:0}),r.beginHosting();const t=window.origin+"?gameId="+r.hostId;window.history.pushState({path:t},"",t),l()}(e.value):alert("Please enter a username")})),s.addEventListener("click",(()=>{e.value?t.value?async function(e,t){const s={id:r.peerId,name:e,x:200,y:200,texture:"character",rotation:0};try{await r.connectToHost(t,s),l()}catch(o){alert("could not connect to game ID "+t)}}(e.value,t.value):alert("Please enter a game ID to join"):alert("Please enter a username")}))};
//# sourceMappingURL=index.ef840a4c.js.map
